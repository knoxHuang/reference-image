'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
module.paths.push(path_1.join(Editor.App.path, 'node_modules'));
// @ts-ignore
const cc_1 = require("cc");
const fs_1 = require("fs");
const NAME = 'Reference-Image';
exports.methods = {
    // 通过图片创建参考图
    async getTargets(openPanel) {
        let canvas = cc_1.find(`Editor Scene Background/${NAME}-Canvas`);
        if (!canvas) {
            canvas = new cc_1.PrivateNode(`${NAME}-Canvas`);
            canvas.addComponent(cc_1.Canvas);
            canvas.parent = cc_1.find('Editor Scene Background');
            if (openPanel) {
                Editor.Panel.open('reference-image');
            }
        }
        let node = canvas.getChildByName(NAME);
        if (!node) {
            node = new cc_1.PrivateNode(NAME);
            node.parent = canvas;
        }
        node.active = await Editor.Profile.getConfig('reference-image', 'show');
        let sprite = node.getComponent(cc_1.Sprite) || node.addComponent(cc_1.Sprite);
        const color = sprite.color;
        color.a = await Editor.Profile.getConfig('reference-image', 'opacity') || 100;
        sprite.color = color;
        cce.Engine.repaintInEditMode();
        return {
            node,
            sprite
        };
    },
    // 移动参考图
    async moveX(x) {
        const { node } = await this.getTargets();
        const position = node.position;
        position.x = x;
        node.position = position;
        cce.Engine.repaintInEditMode();
    },
    async moveY(y) {
        const { node } = await this.getTargets();
        const position = node.position;
        position.y = y;
        node.position = position;
        cce.Engine.repaintInEditMode();
    },
    async setOpacity(opacity) {
        const { sprite } = await this.getTargets();
        const color = sprite.color;
        color.a = opacity;
        sprite.color = color;
        cce.Engine.repaintInEditMode();
    },
    // 切换参考图
    async switchImages(path) {
        const { sprite } = await this.getTargets();
        let data = fs_1.readFileSync(path);
        data = new Buffer(data).toString('base64');
        let image = new Image();
        image.src = 'data:png;base64,' + data;
        image.onload = () => {
            sprite.spriteFrame = cc_1.SpriteFrame.createWithImage(image);
            cce.Engine.repaintInEditMode();
        };
    },
    // 清空
    async resetImage() {
        const { sprite } = await this.getTargets();
        sprite.spriteFrame = null;
        cce.Engine.repaintInEditMode();
    },
    // 设置参考图是否显示
    async setImageVisible(value) {
        const { node } = await this.getTargets(true);
        node.active = value;
        cce.Engine.repaintInEditMode();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtd2Fsa2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL2NvbnRyaWJ1dGlvbnMvc2NlbmUtd2Fsa2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFFYiwrQkFBNEI7QUFLNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7QUFFekQsYUFBYTtBQUNiLDJCQUFnRjtBQUNoRiwyQkFBa0M7QUFFbEMsTUFBTSxJQUFJLEdBQUcsaUJBQWlCLENBQUM7QUFFL0IsT0FBTyxDQUFDLE9BQU8sR0FBRztJQUNkLFlBQVk7SUFDWixLQUFLLENBQUMsVUFBVSxDQUFDLFNBQWtCO1FBQy9CLElBQUksTUFBTSxHQUFHLFNBQUksQ0FBQywyQkFBMkIsSUFBSSxTQUFTLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1QsTUFBTSxHQUFHLElBQUksZ0JBQVcsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFNLENBQUMsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxHQUFHLFNBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1lBQ2hELElBQUksU0FBUyxFQUFFO2dCQUNYLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7YUFDeEM7U0FDSjtRQUNELElBQUksSUFBSSxHQUFHLE1BQU0sQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDdkMsSUFBSSxDQUFDLElBQUksRUFBRTtZQUNQLElBQUksR0FBRyxJQUFJLGdCQUFXLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDN0IsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7U0FDeEI7UUFDRCxJQUFJLENBQUMsTUFB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QUcsSUFBSSxDQUFDO1FBQzFCLEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQsWUFBWTtJQUNaLEtBQUssQ0FBQyxlQUFlLENBQUMsS0FBYztRQUNoQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzdDLElBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFDO1FBQ3BCLEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0NBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJwYXRoXCI7XG5cbmRlY2xhcmUgY29uc3QgY2NlOiBhbnk7XG5kZWNsYXJlIGNvbnN0IEVkaXRvcjogYW55O1xuXG5tb2R1bGUucGF0aHMucHVzaChqb2luKEVkaXRvci5BcHAucGF0aCwgJ25vZGVfbW9kdWxlcycpKTtcblxuLy8gQHRzLWlnbm9yZVxuaW1wb3J0IHsgUHJpdmF0ZU5vZGUsIENhbnZhcywgU3ByaXRlLCBmaW5kLCBJbWFnZUFzc2V0LCBTcHJpdGVGcmFtZSB9IGZyb20gJ2NjJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gXCJmc1wiO1xuXG5jb25zdCBOQU1FID0gJ1JlZmVyZW5jZS1JbWFnZSc7XG5cbmV4cG9ydHMubWV0aG9kcyA9IHtcbiAgICAvLyDpgJrov4flm77niYfliJvlu7rlj4LogIPlm75cbiAgICBhc3luYyBnZXRUYXJnZXRzKG9wZW5QYW5lbDogYm9vbGVhbikge1xuICAgICAgICBsZXQgY2FudmFzID0gZmluZChgRWRpdG9yIFNjZW5lIEJhY2tncm91bmQvJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgaWYgKCFjYW52YXMpIHtcbiAgICAgICAgICAgIGNhbnZhcyA9IG5ldyBQcml2YXRlTm9kZShgJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgICAgIGNhbnZhcy5hZGRDb21wb25lbnQoQ2FudmFzKTtcbiAgICAgICAgICAgIGNhbnZhcy5wYXJlbnQgPSBmaW5kKCdFZGl0b3IgU2NlbmUgQmFja2dyb3VuZCcpO1xuICAgICAgICAgICAgaWYgKG9wZW5QYW5lbCkge1xuICAgICAgICAgICAgICAgIEVkaXRvci5QYW5lbC5vcGVuKCdyZWZlcmVuY2UtaW1hZ2UnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsZXQgbm9kZSA9IGNhbnZhcy5nZXRDaGlsZEJ5TmFtZShOQU1FKTtcbiAgICAgICAgaWYgKCFub2RlKSB7XG4gICAgICAgICAgICBub2RlID0gbmV3IFByaXZhdGVOb2RlKE5BTUUpO1xuICAgICAgICAgICAgbm9kZS5wYXJlbnQgPSBjYW52YXM7XG4gICAgICAgIH1cbiAgICAgICAgbm9kZS5hY3RpdmUgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdzaG93Jyk7XG5cbiAgICAgICAgbGV0IHNwcml0ZSA9IG5vZGUuZ2V0Q29tcG9uZW50KFNwcml0ZSkgfHwgbm9kZS5hZGRDb21wb25lbnQoU3ByaXRlKTtcbiAgICAgICAgY29uc3QgY29sb3IgPSBzcHJpdGUuY29sb3I7XG4gICAgICAgIGNvbG9yLmEgPSBhd2FpdCBFZGl0b3IuUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdvcGFjaXR5JykgfHwgMTAwO1xuICAgICAgICBzcHJpdGUuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbm9kZSxcbiAgICAgICAgICAgIHNwcml0ZVxuICAgICAgICB9XG4gICAgfSxcblxuICAgIC8vIOenu+WKqOWPguiAg+WbvlxuICAgIGFzeW5jIG1vdmVYKHg6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IG5vZGUgfSA9IGF3YWl0IHRoaXMuZ2V0VGFyZ2V0cygpO1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IG5vZGUucG9zaXRpb247XG4gICAgICAgIHBvc2l0aW9uLnggPSB4O1xuICAgICAgICBub2RlLnBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9LFxuXG4gICAgYXN5bmMgbW92ZVkoeTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgbm9kZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbm9kZS5wb3NpdGlvbjtcbiAgICAgICAgcG9zaXRpb24ueSA9IHk7XG4gICAgICAgIG5vZGUucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH0sXG5cbiAgICBhc3luYyBzZXRPcGFjaXR5KG9wYWNpdHk6IG51bWJlcikge1xuICAgICAgICBjb25zdCB7IHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIGNvbnN0IGNvbG9yID0gc3ByaXRlLmNvbG9yO1xuICAgICAgICBjb2xvci5hID0gb3BhY2l0eTtcbiAgICAgICAgc3ByaXRlLmNvbG9yID0gY29sb3I7XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9LFxuXG4gICAgLy8g5YiH5o2i5Y+C6ICD5Zu+XG4gICAgYXN5bmMgc3dpdGNoSW1hZ2VzKHBhdGg6IHN0cmluZykge1xuICAgICAgICBjb25zdCB7IHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIGxldCBkYXRhOiBzdHJpbmcgfCBCdWZmZXIgPSByZWFkRmlsZVN5bmMocGF0aCk7XG4gICAgICAgIGRhdGEgPSBuZXcgQnVmZmVyKGRhdGEpLnRvU3RyaW5nKCdiYXNlNjQnKTtcbiAgICAgICAgbGV0IGltYWdlID0gbmV3IEltYWdlKCk7XG4gICAgICAgIGltYWdlLnNyYyA9ICdkYXRhOnBuZztiYXNlNjQsJyArIGRhdGE7XG4gICAgICAgIGltYWdlLm9ubG9hZCA9ICgpID0+IHtcbiAgICAgICAgICAgIHNwcml0ZS5zcHJpdGVGcmFtZSA9IFNwcml0ZUZyYW1lLmNyZWF0ZVdpdGhJbWFnZShpbWFnZSk7XG4gICAgICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8g5riF56m6XG4gICAgYXN5bmMgcmVzZXRJbWFnZSgpIHtcbiAgICAgICAgY29uc3QgeyBzcHJpdGUgfSA9IGF3YWl0IHRoaXMuZ2V0VGFyZ2V0cygpO1xuICAgICAgICBzcHJpdGUuc3ByaXRlRnJhbWUgPSBudWxsO1xuICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgfSxcblxuICAgIC8vIOiuvue9ruWPguiAg+WbvuaYr+WQpuaYvuekulxuICAgIGFzeW5jIHNldEltYWdlVmlzaWJsZSh2YWx1ZTogYm9vbGVhbikge1xuICAgICAgICBjb25zdCB7IG5vZGUgfSA9IGF3YWl0IHRoaXMuZ2V0VGFyZ2V0cyh0cnVlKTtcbiAgICAgICAgbm9kZS5hY3RpdmUgPSB2YWx1ZTtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH1cbn07XG4iXX0=