'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const path_1 = require("path");
module.paths.push(path_1.join(Editor.App.path, 'node_modules'));
// @ts-ignore
const cc_1 = require("cc");
const fs_1 = require("fs");
const NAME = 'Reference-Image';
exports.methods = {
    // 通过图片创建参考图
    async getTargets() {
        let canvas = cc_1.find(`Editor Scene Background/${NAME}-Canvas`);
        if (!canvas) {
            canvas = new cc_1.PrivateNode(`${NAME}-Canvas`);
            canvas.addComponent(cc_1.Canvas);
            canvas.parent = cc_1.find('Editor Scene Background');
        }
        let node = canvas.getChildByName(NAME);
        if (!node) {
            node = new cc_1.PrivateNode(NAME);
            node.parent = canvas;
        }
        node.active = await Editor.Profile.getConfig('reference-image', 'show');
        let sprite = node.getComponent(cc_1.Sprite) || node.addComponent(cc_1.Sprite);
        const color = sprite.color;
        color.a = await Editor.Profile.getConfig('reference-image', 'opacity') || 100;
        sprite.color = color;
        cce.Engine.repaintInEditMode();
        return {
            node,
            sprite
        };
    },
    // 移动参考图
    async moveX(x) {
        const { node } = await this.getTargets();
        const position = node.position;
        position.x = x;
        node.position = position;
        cce.Engine.repaintInEditMode();
    },
    async moveY(y) {
        const { node } = await this.getTargets();
        const position = node.position;
        position.y = y;
        node.position = position;
        cce.Engine.repaintInEditMode();
    },
    async setOpacity(opacity) {
        const { sprite } = await this.getTargets();
        const color = sprite.color;
        color.a = opacity;
        sprite.color = color;
        cce.Engine.repaintInEditMode();
    },
    // 切换参考图
    async switchImages(path) {
        const { sprite } = await this.getTargets();
        let data = fs_1.readFileSync(path);
        data = new Buffer(data).toString('base64');
        let image = new Image();
        image.src = 'data:png;base64,' + data;
        image.onload = () => {
            sprite.spriteFrame = cc_1.SpriteFrame.createWithImage(image);
            cce.Engine.repaintInEditMode();
        };
    },
    // 清空
    async resetImage() {
        const { sprite } = await this.getTargets();
        sprite.spriteFrame = null;
        cce.Engine.repaintInEditMode();
    },
    // 设置参考图是否显示
    async setImageVisible(value) {
        const { node } = await this.getTargets();
        node.active = value;
        if (value) {
            let images = await Editor.Profile.getConfig('reference-image', 'images');
            if (images && images.length === 0) {
                Editor.Panel.open('reference-image');
            }
        }
        cce.Engine.repaintInEditMode();
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2NlbmUtd2Fsa2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc291cmNlL2NvbnRyaWJ1dGlvbnMvc2NlbmUtd2Fsa2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFFYiwrQkFBNEI7QUFLNUIsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsV0FBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLGNBQWMsQ0FBQyxDQUFDLENBQUM7QUFFekQsYUFBYTtBQUNiLDJCQUFnRjtBQUNoRiwyQkFBa0M7QUFFbEMsTUFBTSxJQUFJLEdBQUcsaUJBQWlCLENBQUM7QUFFL0IsT0FBTyxDQUFDLE9BQU8sR0FBRztJQUNkLFlBQVk7SUFDWixLQUFLLENBQUMsVUFBVTtRQUNaLElBQUksTUFBTSxHQUFHLFNBQUksQ0FBQywyQkFBMkIsSUFBSSxTQUFTLENBQUMsQ0FBQztRQUM1RCxJQUFJLENBQUMsTUFBTSxFQUFFO1lBQ1QsTUFBTSxHQUFHLElBQUksZ0JBQVcsQ0FBQyxHQUFHLElBQUksU0FBUyxDQUFDLENBQUM7WUFDM0MsTUFBTSxDQUFDLFlBQVksQ0FBQyxXQUFNLENBQUMsQ0FBQztZQUM1QixNQUFNLENBQUMsTUFBTSxHQUFHLFNBQUksQ0FBQyx5QkFBeUIsQ0FBQyxDQUFDO1NBQ25EO1FBQ0QsSUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN2QyxJQUFJLENBQUMsSUFBSSxFQUFFO1lBQ1AsSUFBSSxHQUFHLElBQUksZ0JBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUM3QixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztTQUN4QjtRQUNELElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxNQUFNLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxpQkFBaUIsRUFBRSxNQUFNLENBQUMsQ0FBQztRQUV4RSxJQUFJLE1BQU0sR0FBRyxJ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LGVBQWUsQ0FBQyxLQUFjO1FBQ2hDLE1BQU0sRUFBRSxJQUFJLEVBQUUsR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztRQUN6QyxJQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQztRQUNwQixJQUFJLEtBQUssRUFBRTtZQUNQLElBQUksTUFBTSxHQUFHLE1BQU0sTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFDekUsSUFBSSxNQUFNLElBQUksTUFBTSxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQy9CLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUM7YUFDeEM7U0FDSjtRQUNELEdBQUcsQ0FBQyxNQUFNLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0NBQ0osQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IHsgam9pbiB9IGZyb20gXCJwYXRoXCI7XG5cbmRlY2xhcmUgY29uc3QgY2NlOiBhbnk7XG5kZWNsYXJlIGNvbnN0IEVkaXRvcjogYW55O1xuXG5tb2R1bGUucGF0aHMucHVzaChqb2luKEVkaXRvci5BcHAucGF0aCwgJ25vZGVfbW9kdWxlcycpKTtcblxuLy8gQHRzLWlnbm9yZVxuaW1wb3J0IHsgUHJpdmF0ZU5vZGUsIENhbnZhcywgU3ByaXRlLCBmaW5kLCBJbWFnZUFzc2V0LCBTcHJpdGVGcmFtZSB9IGZyb20gJ2NjJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gXCJmc1wiO1xuXG5jb25zdCBOQU1FID0gJ1JlZmVyZW5jZS1JbWFnZSc7XG5cbmV4cG9ydHMubWV0aG9kcyA9IHtcbiAgICAvLyDpgJrov4flm77niYfliJvlu7rlj4LogIPlm75cbiAgICBhc3luYyBnZXRUYXJnZXRzKCkge1xuICAgICAgICBsZXQgY2FudmFzID0gZmluZChgRWRpdG9yIFNjZW5lIEJhY2tncm91bmQvJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgaWYgKCFjYW52YXMpIHtcbiAgICAgICAgICAgIGNhbnZhcyA9IG5ldyBQcml2YXRlTm9kZShgJHtOQU1FfS1DYW52YXNgKTtcbiAgICAgICAgICAgIGNhbnZhcy5hZGRDb21wb25lbnQoQ2FudmFzKTtcbiAgICAgICAgICAgIGNhbnZhcy5wYXJlbnQgPSBmaW5kKCdFZGl0b3IgU2NlbmUgQmFja2dyb3VuZCcpO1xuICAgICAgICB9XG4gICAgICAgIGxldCBub2RlID0gY2FudmFzLmdldENoaWxkQnlOYW1lKE5BTUUpO1xuICAgICAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgICAgIG5vZGUgPSBuZXcgUHJpdmF0ZU5vZGUoTkFNRSk7XG4gICAgICAgICAgICBub2RlLnBhcmVudCA9IGNhbnZhcztcbiAgICAgICAgfVxuICAgICAgICBub2RlLmFjdGl2ZSA9IGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Nob3cnKTtcblxuICAgICAgICBsZXQgc3ByaXRlID0gbm9kZS5nZXRDb21wb25lbnQoU3ByaXRlKSB8fCBub2RlLmFkZENvbXBvbmVudChTcHJpdGUpO1xuICAgICAgICBjb25zdCBjb2xvciA9IHNwcml0ZS5jb2xvcjtcbiAgICAgICAgY29sb3IuYSA9IGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ29wYWNpdHknKSB8fCAxMDA7XG4gICAgICAgIHNwcml0ZS5jb2xvciA9IGNvbG9yO1xuICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBub2RlLFxuICAgICAgICAgICAgc3ByaXRlXG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLy8g56e75Yqo5Y+C6ICD5Zu+XG4gICAgYXN5bmMgbW92ZVgoeDogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgbm9kZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIGNvbnN0IHBvc2l0aW9uID0gbm9kZS5wb3NpdGlvbjtcbiAgICAgICAgcG9zaXRpb24ueCA9IHg7XG4gICAgICAgIG5vZGUucG9zaXRpb24gPSBwb3NpdGlvbjtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH0sXG5cbiAgICBhc3luYyBtb3ZlWSh5OiBudW1iZXIpIHtcbiAgICAgICAgY29uc3QgeyBub2RlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgY29uc3QgcG9zaXRpb24gPSBub2RlLnBvc2l0aW9uO1xuICAgICAgICBwb3NpdGlvbi55ID0geTtcbiAgICAgICAgbm9kZS5wb3NpdGlvbiA9IHBvc2l0aW9uO1xuICAgICAgICBjY2UuRW5naW5lLnJlcGFpbnRJbkVkaXRNb2RlKCk7XG4gICAgfSxcblxuICAgIGFzeW5jIHNldE9wYWNpdHkob3BhY2l0eTogbnVtYmVyKSB7XG4gICAgICAgIGNvbnN0IHsgc3ByaXRlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgY29uc3QgY29sb3IgPSBzcHJpdGUuY29sb3I7XG4gICAgICAgIGNvbG9yLmEgPSBvcGFjaXR5O1xuICAgICAgICBzcHJpdGUuY29sb3IgPSBjb2xvcjtcbiAgICAgICAgY2NlLkVuZ2luZS5yZXBhaW50SW5FZGl0TW9kZSgpO1xuICAgIH0sXG5cbiAgICAvLyDliIfmjaLlj4LogIPlm75cbiAgICBhc3luYyBzd2l0Y2hJbWFnZXMocGF0aDogc3RyaW5nKSB7XG4gICAgICAgIGNvbnN0IHsgc3ByaXRlIH0gPSBhd2FpdCB0aGlzLmdldFRhcmdldHMoKTtcbiAgICAgICAgbGV0IGRhdGE6IHN0cmluZyB8IEJ1ZmZlciA9IHJlYWRGaWxlU3luYyhwYXRoKTtcbiAgICAgICAgZGF0YSA9IG5ldyBCdWZmZXIoZGF0YSkudG9TdHJpbmcoJ2Jhc2U2NCcpO1xuICAgICAgICBsZXQgaW1hZ2UgPSBuZXcgSW1hZ2UoKTtcbiAgICAgICAgaW1hZ2Uuc3JjID0gJ2RhdGE6cG5nO2Jhc2U2NCwnICsgZGF0YTtcbiAgICAgICAgaW1hZ2Uub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgc3ByaXRlLnNwcml0ZUZyYW1lID0gU3ByaXRlRnJhbWUuY3JlYXRlV2l0aEltYWdlKGltYWdlKTtcbiAgICAgICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvLyDmuIXnqbpcbiAgICBhc3luYyByZXNldEltYWdlKCkge1xuICAgICAgICBjb25zdCB7IHNwcml0ZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIHNwcml0ZS5zcHJpdGVGcmFtZSA9IG51bGw7XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9LFxuXG4gICAgLy8g6K6+572u5Y+C6ICD5Zu+5piv5ZCm5pi+56S6XG4gICAgYXN5bmMgc2V0SW1hZ2VWaXNpYmxlKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIGNvbnN0IHsgbm9kZSB9ID0gYXdhaXQgdGhpcy5nZXRUYXJnZXRzKCk7XG4gICAgICAgIG5vZGUuYWN0aXZlID0gdmFsdWU7XG4gICAgICAgIGlmICh2YWx1ZSkge1xuICAgICAgICAgICAgbGV0IGltYWdlcyA9IGF3YWl0IEVkaXRvci5Qcm9maWxlLmdldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ2ltYWdlcycpO1xuICAgICAgICAgICAgaWYgKGltYWdlcyAmJiBpbWFnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgRWRpdG9yLlBhbmVsLm9wZW4oJ3JlZmVyZW5jZS1pbWFnZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNjZS5FbmdpbmUucmVwYWludEluRWRpdE1vZGUoKTtcbiAgICB9XG59O1xuIl19