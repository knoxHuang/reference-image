'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
exports.close = exports.ready = exports.methods = exports.$ = exports.template = exports.style = void 0;
const path_1 = require("path");
const fs_1 = require("fs");
const { I18n, Message, Dialog, Profile } = Editor;
exports.style = fs_1.readFileSync(path_1.join(__dirname, '../../dist/index.css'), 'utf8');
exports.template = fs_1.readFileSync(path_1.join(__dirname, '../../statics/index.html'), 'utf8');
let ui_editor;
let ui_images;
let ui_x;
let ui_y;
let ui_opacity;
let btn_add;
let btn_del;
exports.$ = {
    ui_editor: '.config',
    ui_images: '.images',
    btnAdd: '.add-image',
    btnDel: '.del-image',
    x: '.x',
    y: '.y',
    opacity: '.opacity'
};
let images = [];
let index = 0;
let x = 0;
let y = 0;
let opacity = 0;
let show = true;
let onMoveXFunc;
let onMoveYFunc;
let onAddImageFunc;
let onDelImageFunc;
let onSetOpacityFunc;
let onSwitchImagesFunc;
exports.methods = {
    async 'scene:ready'() {
        this.sendSwitchImages();
        Message.broadcast('reference-image:show', show);
    },
    async updateImages() {
        // @ts-ignore
        const panel = this;
        // clear
        while (ui_images.firstChild) {
            ui_images.removeChild(ui_images.firstChild);
        }
        for (let i = 0; i < images.length; ++i) {
            const option = document.createElement('option');
            option.setAttribute('value', `${i}`);
            ui_images.appendChild(option);
            const path = images[i];
            option.text = path_1.basename(path, path_1.extname(path));
        }
        btn_del.removeAttribute('disabled');
        ui_editor.removeAttribute('disabled');
        ui_images.removeAttribute('placeholder');
        ui_images.setAttribute('value', '');
        if (images.length === 0) {
            ui_images.setAttribute('placeholder', I18n.t('reference-image.none'));
            btn_del.setAttribute('disabled', '');
            ui_editor.setAttribute('disabled', '');
            await this.resetImage();
        }
        else {
            ui_images.setAttribute('value', `${index}`);
            await this.sendSwitchImages();
        }
    },
    async onAddImage() {
        const result = await Dialog.select({
            title: I18n.t('reference-image.dialog.add-image-title'),
            path: await Profile.getConfig('reference-image', 'root-path') || '',
            filters: [{ name: 'image', extensions: ['png', 'jpg'] }],
        });
        if (!result || !result.filePaths[0]) {
            return;
        }
        for (let path of result.filePaths) {
            if (!images.includes(path)) {
                images.push(path);
            }
        }
        index = images.length - 1;
        await this.updateImages();
        const path = path_1.dirname(result.filePaths[0]);
        await Profile.setConfig('reference-image', 'root-path', path);
    },
    async onDelImage() {
        const result = await Dialog.info(I18n.t('reference-image.dialog.del_image_message', {
            path: images[index]
        }), {
            buttons: [
                I18n.t('reference-image.dialog.yes'),
                I18n.t('reference-image.dialog.cancel'),
            ],
            default: 0,
            cancel: 1,
        });
        if (result.response === 0) {
            images.splice(index, 1);
            index--;
            if (index < 0) {
                index = 0;
            }
            await this.updateImages();
        }
    },
    async resetImage() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'resetImage',
        });
    },
    async sendSwitchImages() {
        const path = images[index];
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'switchImages',
            args: [path],
        });
        await this.sendMoveX();
        await this.sendMoveY();
        await this.sendOpacity();
    },
    async onSwitchImages(event) {
        // @ts-ignore
        index = parseInt(event.target.value);
        await this.sendSwitchImages();
    },
    async sendOpacity() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'setOpacity',
            args: [opacity],
        });
    },
    async sendMoveX() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveX',
            args: [x],
        });
    },
    async sendMoveY() {
        await Message.request('scene', 'execute-scene-script', {
            name: 'reference-image',
            method: 'moveY',
            args: [y],
        });
    },
    async onMoveX(event) {
        // @ts-ignore
        x = event.target.value;
        await Profile.setConfig('reference-image', 'x', x);
        await this.sendMoveX();
    },
    async onMoveY(event) {
        // @ts-ignore
        y = event.target.value;
        await Profile.setConfig('reference-image', 'y', y);
        await this.sendMoveY();
    },
    async onSetOpacity(event) {
        // @ts-ignore
        opacity = event.target.value;
        await Profile.setConfig('reference-image', 'opacity', opacity);
        await this.sendOpacity();
    },
    registerEventListeners() {
        onMoveXFunc = this.onMoveX.bind(this);
        onMoveYFunc = this.onMoveY.bind(this);
        onSetOpacityFunc = this.onSetOpacity.bind(this);
        onSwitchImagesFunc = this.onSwitchImages.bind(this);
        onAddImageFunc = this.onAddImage.bind(this);
        onDelImageFunc = this.onDelImage.bind(this);
        ui_x.addEventListener('confirm', onMoveXFunc);
        ui_y.addEventListener('confirm', onMoveYFunc);
        ui_opacity.addEventListener('confirm', onSetOpacityFunc);
        ui_images.addEventListener('confirm', onSwitchImagesFunc);
        btn_add.addEventListener('click', onAddImageFunc);
        btn_del.addEventListener('click', onDelImageFunc);
    },
    unregisterEventListeners() {
        ui_x.removeEventListener('confirm', onMoveXFunc);
        ui_y.removeEventListener('confirm', onMoveYFunc);
        ui_opacity.removeEventListener('confirm', onSetOpacityFunc);
        ui_images.removeEventListener('confirm', onSwitchImagesFunc);
        btn_add.removeEventListener('click', onAddImageFunc);
        btn_del.removeEventListener('click', onDelImageFunc);
    }
};
exports.ready = async function () {
    // @ts-ignore
    const panel = this;
    ui_x = panel.$.x;
    ui_y = panel.$.y;
    ui_editor = panel.$.ui_editor;
    ui_images = panel.$.ui_images;
    ui_opacity = panel.$.opacity;
    btn_add = panel.$.btnAdd;
    btn_del = panel.$.btnDel;
    panel.registerEventListeners();
    x = await Profile.getConfig('reference-image', 'x') || 0;
    y = await Profile.getConfig('reference-image', 'y') || 0;
    opacity = await Profile.getConfig('reference-image', 'opacity') || 100;
    index = await Profile.getConfig('reference-image', 'index') || index;
    images = await Profile.getConfig('reference-image', 'images') || [];
    // @ts-ignore
    ui_x.value = x;
    // @ts-ignore
    ui_y.value = y;
    // @ts-ignore
    ui_opacity.value = opacity;
    // @ts-ignore
    ui_images.value = index;
    await panel.updateImages();
    show = await Profile.getConfig('reference-image', 'show');
    Message.broadcast('reference-image:show', show);
};
exports.close = async function () {
    // @ts-ignore
    this.unregisterEventListeners();
    await Profile.setConfig('reference-image', 'images', images);
    await Profile.setConfig('reference-image', 'index', index);
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zb3VyY2UvcGFuZWwvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7QUFJYiwrQkFBd0Q7QUFDeEQsMkJBQWtDO0FBRWxDLE1BQU0sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsR0FBRyxNQUFNLENBQUM7QUFFckMsUUFBQSxLQUFLLEdBQUcsaUJBQVksQ0FBQyxXQUFJLENBQUMsU0FBUyxFQUFFLHNCQUFzQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFDdEUsUUFBQSxRQUFRLEdBQUcsaUJBQVksQ0FBQyxXQUFJLENBQUMsU0FBUyxFQUFFLDBCQUEwQixDQUFDLEVBQUUsTUFBTSxDQUFDLENBQUM7QUFFMUYsSUFBSSxTQUFzQixDQUFDO0FBQzNCLElBQUksU0FBc0IsQ0FBQztBQUMzQixJQUFJLElBQWlCLENBQUM7QUFDdEIsSUFBSSxJQUFpQixDQUFDO0FBQ3RCLElBQUksVUFBdUIsQ0FBQztBQUM1QixJQUFJLE9BQW9CLENBQUM7QUFDekIsSUFBSSxPQUFvQixDQUFDO0FBQ1osUUFBQSxDQUFDLEdBQUc7SUFDYixTQUFTLEVBQUUsU0FBUztJQUNwQixTQUFTLEVBQUUsU0FBUztJQUNwQixNQUFNLEVBQUUsWUFBWTtJQUNwQixNQUFNLEVBQUUsWUFBWTtJQUVwQixDQUFDLEVBQUUsSUFBSTtJQUNQLENBQUMsRUFBRSxJQUFJO0lBQ1AsT0FBTyxFQUFFLFVBQVU7Q0FDdEIsQ0FBQztBQUVGLElBQUksTUFBTSxHQUFhLEVBQUUsQ0FBQztBQUMxQixJQUFJLEtBQUssR0FBVyxDQUFDLENBQUM7QUFDdEIsSUFBSSxDQUFDLEdBQVcsQ0FBQyxDQUFDO0FBQ2xCLElBQUksQ0FBQyxHQUFXLENBQUMsQ0FBQztBQUNsQixJQUFJLE9BQU8sR0FBVyxDQUFDLENBQUM7QUFDeEIsSUFBSSxJQUFJLEdBQUcsSUFB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QUFDO0lBQ2YsYUFBYTtJQUNiLElBQUksQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDO0lBQ2YsYUFBYTtJQUNiLFVBQVUsQ0FBQyxLQUFLLEdBQUcsT0FBTyxDQUFDO0lBQzNCLGFBQWE7SUFDYixTQUFTLENBQUMsS0FBSyxHQUFHLEtBQUssQ0FBQztJQUN4QixNQUFNLEtBQUssQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUUzQixJQUFJLEdBQUcsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzFELE9BQU8sQ0FBQyxTQUFTLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFDcEQsQ0FBQyxDQUFDO0FBRVcsUUFBQSxLQUFLLEdBQUcsS0FBSztJQUN0QixhQUFhO0lBQ2IsSUFBSSxDQUFDLHdCQUF3QixFQUFFLENBQUM7SUFDaEMsTUFBTSxPQUFPLENBQUMsU0FBUyxDQUFDLGlCQUFpQixFQUFFLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztJQUM3RCxNQUFNLE9BQU8sQ0FBQyxTQUFTLENBQUMsaUJBQWlCLEVBQUUsT0FBTyxFQUFFLEtBQUssQ0FBQyxDQUFDO0FBQy9ELENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcblxuZGVjbGFyZSBjb25zdCBFZGl0b3I6IGFueTtcblxuaW1wb3J0IHsgZGlybmFtZSwgYmFzZW5hbWUsIGV4dG5hbWUsIGpvaW4gfSBmcm9tICdwYXRoJztcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gXCJmc1wiO1xuXG5jb25zdCB7IEkxOG4sIE1lc3NhZ2UsIERpYWxvZywgUHJvZmlsZSB9ID0gRWRpdG9yO1xuXG5leHBvcnQgY29uc3Qgc3R5bGUgPSByZWFkRmlsZVN5bmMoam9pbihfX2Rpcm5hbWUsICcuLi8uLi9kaXN0L2luZGV4LmNzcycpLCAndXRmOCcpO1xuZXhwb3J0IGNvbnN0IHRlbXBsYXRlID0gcmVhZEZpbGVTeW5jKGpvaW4oX19kaXJuYW1lLCAnLi4vLi4vc3RhdGljcy9pbmRleC5odG1sJyksICd1dGY4Jyk7XG5cbmxldCB1aV9lZGl0b3I6IEhUTUxFbGVtZW50O1xubGV0IHVpX2ltYWdlczogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeDogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfeTogSFRNTEVsZW1lbnQ7XG5sZXQgdWlfb3BhY2l0eTogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2FkZDogSFRNTEVsZW1lbnQ7XG5sZXQgYnRuX2RlbDogSFRNTEVsZW1lbnQ7XG5leHBvcnQgY29uc3QgJCA9IHtcbiAgICB1aV9lZGl0b3I6ICcuY29uZmlnJyxcbiAgICB1aV9pbWFnZXM6ICcuaW1hZ2VzJyxcbiAgICBidG5BZGQ6ICcuYWRkLWltYWdlJyxcbiAgICBidG5EZWw6ICcuZGVsLWltYWdlJyxcblxuICAgIHg6ICcueCcsXG4gICAgeTogJy55JyxcbiAgICBvcGFjaXR5OiAnLm9wYWNpdHknXG59O1xuXG5sZXQgaW1hZ2VzOiBzdHJpbmdbXSA9IFtdO1xubGV0IGluZGV4OiBudW1iZXIgPSAwO1xubGV0IHg6IG51bWJlciA9IDA7XG5sZXQgeTogbnVtYmVyID0gMDtcbmxldCBvcGFjaXR5OiBudW1iZXIgPSAwO1xubGV0IHNob3cgPSB0cnVlO1xuXG5sZXQgb25Nb3ZlWEZ1bmM6IGFueTtcbmxldCBvbk1vdmVZRnVuYzogYW55O1xubGV0IG9uQWRkSW1hZ2VGdW5jOiBhbnk7XG5sZXQgb25EZWxJbWFnZUZ1bmM6IGFueTtcbmxldCBvblNldE9wYWNpdHlGdW5jOiBhbnk7XG5sZXQgb25Td2l0Y2hJbWFnZXNGdW5jOiBhbnk7XG5leHBvcnQgY29uc3QgbWV0aG9kcyA9IHtcblxuICAgIGFzeW5jICdzY2VuZTpyZWFkeScoKSB7XG4gICAgICAgIHRoaXMuc2VuZFN3aXRjaEltYWdlcygpO1xuICAgICAgICBNZXNzYWdlLmJyb2FkY2FzdCgncmVmZXJlbmNlLWltYWdlOnNob3cnLCBzaG93KTtcbiAgICB9LFxuXG4gICAgYXN5bmMgdXBkYXRlSW1hZ2VzKCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGNvbnN0IHBhbmVsID0gdGhpcztcbiAgICAgICAgLy8gY2xlYXJcbiAgICAgICAgd2hpbGUgKCB1aV9pbWFnZXMuZmlyc3RDaGlsZCApIHtcbiAgICAgICAgICAgIHVpX2ltYWdlcy5yZW1vdmVDaGlsZCh1aV9pbWFnZXMuZmlyc3RDaGlsZCk7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgICAgICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBgJHtpfWApO1xuICAgICAgICAgICAgdWlfaW1hZ2VzLmFwcGVuZENoaWxkKG9wdGlvbik7XG4gICAgICAgICAgICBjb25zdCBwYXRoID0gaW1hZ2VzW2ldO1xuICAgICAgICAgICAgb3B0aW9uLnRleHQgPSBiYXNlbmFtZShwYXRoLCBleHRuYW1lKHBhdGgpKTtcbiAgICAgICAgfVxuICAgICAgICBidG5fZGVsLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfZWRpdG9yLnJlbW92ZUF0dHJpYnV0ZSgnZGlzYWJsZWQnKTtcbiAgICAgICAgdWlfaW1hZ2VzLnJlbW92ZUF0dHJpYnV0ZSgncGxhY2Vob2xkZXInKTtcbiAgICAgICAgdWlfaW1hZ2VzLnNldEF0dHJpYnV0ZSgndmFsdWUnLCAnJyk7XG4gICAgICAgIGlmIChpbWFnZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB1aV9pbWFnZXMuc2V0QXR0cmlidXRlKCdwbGFjZWhvbGRlcicsIEkxOG4udCgncmVmZXJlbmNlLWltYWdlLm5vbmUnKSk7XG4gICAgICAgICAgICBidG5fZGVsLnNldEF0dHJpYnV0ZSgnZGlzYWJsZWQnLCAnJyk7XG4gICAgICAgICAgICB1aV9lZGl0b3Iuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsICcnKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucmVzZXRJbWFnZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdWlfaW1hZ2VzLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBgJHtpbmRleH1gKTtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZFN3aXRjaEltYWdlcygpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGFzeW5jIG9uQWRkSW1hZ2UoKSB7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IERpYWxvZy5zZWxlY3Qoe1xuICAgICAgICAgICAgdGl0bGU6IEkxOG4udCgncmVmZXJlbmNlLWltYWdlLmRpYWxvZy5hZGQtaW1hZ2UtdGl0bGUnKSxcbiAgICAgICAgICAgIHBhdGg6IGF3YWl0IFByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAncm9vdC1wYXRoJykgfHwgJycsXG4gICAgICAgICAgICBmaWx0ZXJzOiBbeyBuYW1lOiAnaW1hZ2UnLCBleHRlbnNpb25zOiBbJ3BuZycsICdqcGcnXSB9XSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICghcmVzdWx0IHx8ICFyZXN1bHQuZmlsZVBhdGhzWzBdKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgcGF0aCBvZiByZXN1bHQuZmlsZVBhdGhzKSB7XG4gICAgICAgICAgICBpZiAoIWltYWdlcy5pbmNsdWRlcyhwYXRoKSkge1xuICAgICAgICAgICAgICAgIGltYWdlcy5wdXNoKHBhdGgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGluZGV4ID0gaW1hZ2VzLmxlbmd0aCAtIDE7XG4gICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1hZ2VzKCk7XG4gICAgICAgIGNvbnN0IHBhdGggPSBkaXJuYW1lKHJlc3VsdC5maWxlUGF0aHNbMF0pO1xuICAgICAgICBhd2FpdCBQcm9maWxlLnNldENvbmZpZygncmVmZXJlbmNlLWltYWdlJywgJ3Jvb3QtcGF0aCcsIHBhdGgpO1xuICAgIH0sXG5cbiAgICBhc3luYyBvbkRlbEltYWdlKCkge1xuICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBEaWFsb2cuaW5mbyhJMThuLnQoJ3JlZmVyZW5jZS1pbWFnZS5kaWFsb2cuZGVsX2ltYWdlX21lc3NhZ2UnLCB7XG4gICAgICAgICAgICBwYXRoOiBpbWFnZXNbaW5kZXhdXG4gICAgICAgIH0pLCB7XG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgICAgSTE4bi50KCdyZWZlcmVuY2UtaW1hZ2UuZGlhbG9nLnllcycpLFxuICAgICAgICAgICAgICAgIEkxOG4udCgncmVmZXJlbmNlLWltYWdlLmRpYWxvZy5jYW5jZWwnKSxcbiAgICAgICAgICAgIF0sXG4gICAgICAgICAgICBkZWZhdWx0OiAwLFxuICAgICAgICAgICAgY2FuY2VsOiAxLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHJlc3VsdC5yZXNwb25zZSA9PT0gMCkge1xuICAgICAgICAgICAgaW1hZ2VzLnNwbGljZShpbmRleCwgMSk7XG4gICAgICAgICAgICBpbmRleC0tO1xuICAgICAgICAgICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgICAgICAgICAgIGluZGV4ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMudXBkYXRlSW1hZ2VzKCk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgYXN5bmMgcmVzZXRJbWFnZSgpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAncmVzZXRJbWFnZScsXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhc3luYyBzZW5kU3dpdGNoSW1hZ2VzKCkge1xuICAgICAgICBjb25zdCBwYXRoOiBzdHJpbmcgPSBpbWFnZXNbaW5kZXhdO1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdzd2l0Y2hJbWFnZXMnLFxuICAgICAgICAgICAgYXJnczogWyBwYXRoIF0sXG4gICAgICAgIH0pO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWCgpO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWSgpO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRPcGFjaXR5KCk7XG4gICAgfSxcblxuICAgIGFzeW5jIG9uU3dpdGNoSW1hZ2VzKGV2ZW50OiBFdmVudCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGluZGV4ID0gcGFyc2VJbnQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgYXdhaXQgdGhpcy5zZW5kU3dpdGNoSW1hZ2VzKCk7XG4gICAgfSxcblxuICAgIGFzeW5jIHNlbmRPcGFjaXR5KCkge1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdzZXRPcGFjaXR5JyxcbiAgICAgICAgICAgIGFyZ3M6IFsgb3BhY2l0eSBdLFxuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgYXN5bmMgc2VuZE1vdmVYKCkge1xuICAgICAgICBhd2FpdCBNZXNzYWdlLnJlcXVlc3QoJ3NjZW5lJywgJ2V4ZWN1dGUtc2NlbmUtc2NyaXB0Jywge1xuICAgICAgICAgICAgbmFtZTogJ3JlZmVyZW5jZS1pbWFnZScsXG4gICAgICAgICAgICBtZXRob2Q6ICdtb3ZlWCcsXG4gICAgICAgICAgICBhcmdzOiBbIHggXSxcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGFzeW5jIHNlbmRNb3ZlWSgpIHtcbiAgICAgICAgYXdhaXQgTWVzc2FnZS5yZXF1ZXN0KCdzY2VuZScsICdleGVjdXRlLXNjZW5lLXNjcmlwdCcsIHtcbiAgICAgICAgICAgIG5hbWU6ICdyZWZlcmVuY2UtaW1hZ2UnLFxuICAgICAgICAgICAgbWV0aG9kOiAnbW92ZVknLFxuICAgICAgICAgICAgYXJnczogWyB5IF0sXG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICBhc3luYyBvbk1vdmVYKGV2ZW50OiBFdmVudCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHggPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IFByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAneCcsIHgpO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWCgpO1xuICAgIH0sXG5cbiAgICBhc3luYyBvbk1vdmVZKGV2ZW50OiBFdmVudCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHkgPSBldmVudC50YXJnZXQudmFsdWU7XG4gICAgICAgIGF3YWl0IFByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAneScsIHkpO1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRNb3ZlWSgpO1xuICAgIH0sXG5cbiAgICBhc3luYyBvblNldE9wYWNpdHkoZXZlbnQ6IEV2ZW50KSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgb3BhY2l0eSA9IGV2ZW50LnRhcmdldC52YWx1ZTtcbiAgICAgICAgYXdhaXQgUHJvZmlsZS5zZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdvcGFjaXR5Jywgb3BhY2l0eSk7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZE9wYWNpdHkoKTtcbiAgICB9LFxuXG4gICAgcmVnaXN0ZXJFdmVudExpc3RlbmVycygpIHtcbiAgICAgICAgb25Nb3ZlWEZ1bmMgPSB0aGlzLm9uTW92ZVguYmluZCh0aGlzKTtcbiAgICAgICAgb25Nb3ZlWUZ1bmMgPSB0aGlzLm9uTW92ZVkuYmluZCh0aGlzKTtcbiAgICAgICAgb25TZXRPcGFjaXR5RnVuYyA9IHRoaXMub25TZXRPcGFjaXR5LmJpbmQodGhpcyk7XG4gICAgICAgIG9uU3dpdGNoSW1hZ2VzRnVuYyA9IHRoaXMub25Td2l0Y2hJbWFnZXMuYmluZCh0aGlzKTtcbiAgICAgICAgb25BZGRJbWFnZUZ1bmMgPSB0aGlzLm9uQWRkSW1hZ2UuYmluZCh0aGlzKTtcbiAgICAgICAgb25EZWxJbWFnZUZ1bmMgPSB0aGlzLm9uRGVsSW1hZ2UuYmluZCh0aGlzKTtcblxuICAgICAgICB1aV94LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvbk1vdmVYRnVuYyk7XG4gICAgICAgIHVpX3kuYWRkRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVlGdW5jKTtcbiAgICAgICAgdWlfb3BhY2l0eS5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25TZXRPcGFjaXR5RnVuYyk7XG4gICAgICAgIHVpX2ltYWdlcy5hZGRFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Td2l0Y2hJbWFnZXNGdW5jKTtcbiAgICAgICAgYnRuX2FkZC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQWRkSW1hZ2VGdW5jKTtcbiAgICAgICAgYnRuX2RlbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRGVsSW1hZ2VGdW5jKTtcbiAgICB9LFxuXG4gICAgdW5yZWdpc3RlckV2ZW50TGlzdGVuZXJzKCkge1xuICAgICAgICB1aV94LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCBvbk1vdmVYRnVuYyk7XG4gICAgICAgIHVpX3kucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29uZmlybScsIG9uTW92ZVlGdW5jKTtcbiAgICAgICAgdWlfb3BhY2l0eS5yZW1vdmVFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25TZXRPcGFjaXR5RnVuYyk7XG4gICAgICAgIHVpX2ltYWdlcy5yZW1vdmVFdmVudExpc3RlbmVyKCdjb25maXJtJywgb25Td2l0Y2hJbWFnZXNGdW5jKTtcbiAgICAgICAgYnRuX2FkZC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQWRkSW1hZ2VGdW5jKTtcbiAgICAgICAgYnRuX2RlbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uRGVsSW1hZ2VGdW5jKTtcbiAgICB9XG59O1xuXG5leHBvcnQgY29uc3QgcmVhZHkgPSBhc3luYyBmdW5jdGlvbigpIHtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgY29uc3QgcGFuZWwgPSB0aGlzO1xuXG4gICAgdWlfeCA9IHBhbmVsLiQueDtcbiAgICB1aV95ID0gcGFuZWwuJC55O1xuICAgIHVpX2VkaXRvciA9IHBhbmVsLiQudWlfZWRpdG9yO1xuICAgIHVpX2ltYWdlcyA9IHBhbmVsLiQudWlfaW1hZ2VzO1xuICAgIHVpX29wYWNpdHkgPSBwYW5lbC4kLm9wYWNpdHk7XG4gICAgYnRuX2FkZCA9IHBhbmVsLiQuYnRuQWRkO1xuICAgIGJ0bl9kZWwgPSBwYW5lbC4kLmJ0bkRlbDtcblxuICAgIHBhbmVsLnJlZ2lzdGVyRXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB4ID0gYXdhaXQgUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICd4JykgfHwgMDtcbiAgICB5ID0gYXdhaXQgUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICd5JykgfHwgMDtcbiAgICBvcGFjaXR5ID0gYXdhaXQgUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdvcGFjaXR5JykgfHwgMTAwO1xuICAgIGluZGV4ID0gYXdhaXQgUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdpbmRleCcpIHx8IGluZGV4O1xuICAgIGltYWdlcyA9IGF3YWl0IFByb2ZpbGUuZ2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnaW1hZ2VzJykgfHwgW107XG5cbiAgICAvLyBAdHMtaWdub3JlXG4gICAgdWlfeC52YWx1ZSA9IHg7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHVpX3kudmFsdWUgPSB5O1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICB1aV9vcGFjaXR5LnZhbHVlID0gb3BhY2l0eTtcbiAgICAvLyBAdHMtaWdub3JlXG4gICAgdWlfaW1hZ2VzLnZhbHVlID0gaW5kZXg7XG4gICAgYXdhaXQgcGFuZWwudXBkYXRlSW1hZ2VzKCk7XG5cbiAgICBzaG93ID0gYXdhaXQgUHJvZmlsZS5nZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdzaG93Jyk7XG4gICAgTWVzc2FnZS5icm9hZGNhc3QoJ3JlZmVyZW5jZS1pbWFnZTpzaG93Jywgc2hvdyk7XG59O1xuXG5leHBvcnQgY29uc3QgY2xvc2UgPSBhc3luYyBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQHRzLWlnbm9yZVxuICAgIHRoaXMudW5yZWdpc3RlckV2ZW50TGlzdGVuZXJzKCk7XG4gICAgYXdhaXQgUHJvZmlsZS5zZXRDb25maWcoJ3JlZmVyZW5jZS1pbWFnZScsICdpbWFnZXMnLCBpbWFnZXMpO1xuICAgIGF3YWl0IFByb2ZpbGUuc2V0Q29uZmlnKCdyZWZlcmVuY2UtaW1hZ2UnLCAnaW5kZXgnLCBpbmRleCk7XG59O1xuIl19